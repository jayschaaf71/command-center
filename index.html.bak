<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no">
<title>EpicLife OS</title>
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="theme-color" content="#07070C">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=DM+Sans:opsz,wght@9..40,300;9..40,400;9..40,500;9..40,600;9..40,700&family=Playfair+Display:ital,wght@0,400;0,700;1,400&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
<style>
*{box-sizing:border-box;margin:0;padding:0}
:root{
  --bg:#07070C;--surface:#0F0F18;--card:#131320;--border:#2D2D44;--border2:#3A3A55;
  --gold:#C9A227;--gold-dim:#C9A22740;--gold-bg:#C9A22712;
  --green:#10B981;--blue:#3B82F6;--red:#EF4444;--amber:#F59E0B;--purple:#8B5CF6;--pink:#EC4899;--lilac:#A78BFA;
  --text:#EAEDF2;--text2:#A0A4B8;--text3:#6B7084;--muted:#444960;--dim:#2D2D44;
}
html,body{height:100%;background:var(--bg);color:var(--text);font-family:'DM Sans',sans-serif;overflow-x:hidden;-webkit-font-smoothing:antialiased}
::-webkit-scrollbar{width:4px}::-webkit-scrollbar-thumb{background:var(--border);border-radius:4px}
.mono{font-family:'JetBrains Mono',monospace}.serif{font-family:'Playfair Display',serif}
button{cursor:pointer;font-family:inherit}input{font-family:inherit}input:focus{outline:none}
@keyframes fadeUp{from{opacity:0;transform:translateY(8px)}to{opacity:1;transform:translateY(0)}}
@keyframes fadeIn{from{opacity:0}to{opacity:1}}
@keyframes breathe{0%,100%{transform:scale(1);opacity:.2}50%{transform:scale(1.12);opacity:.45}}
@keyframes shimmer{0%{background-position:-200% center}100%{background-position:200% center}}
@keyframes pulse{0%,100%{opacity:1}50%{opacity:.35}}
@keyframes affirmRotate{0%{opacity:0;transform:translateY(8px)}12%{opacity:1;transform:translateY(0)}88%{opacity:1;transform:translateY(0)}100%{opacity:0;transform:translateY(-8px)}}
.gold-shim{background:linear-gradient(90deg,#C9A227,#FFD700,#C9A227);background-size:200% auto;-webkit-background-clip:text;-webkit-text-fill-color:transparent;animation:shimmer 3s linear infinite}
.card{background:var(--card);border:1px solid var(--border);border-radius:12px;box-shadow:0 2px 12px rgba(0,0,0,.35)}
.sec-label{font-size:13px;font-weight:700;color:var(--text);letter-spacing:.04em;display:flex;align-items:center;gap:6px}
.sec-label .dot{width:4px;height:4px;border-radius:2px;background:var(--gold)}
.vtile{cursor:pointer;transition:all .4s cubic-bezier(.4,0,.2,1);overflow:hidden;position:relative;border-radius:14px;border:1px solid #ffffff10}
.vtile:hover{transform:scale(1.015);z-index:10;border-color:#ffffff20}
.vtile:hover .vov{opacity:.45!important}
.vrow{cursor:pointer;transition:background .1s}.vrow:hover{background:#18182A}
.htile{cursor:pointer;transition:all .1s;user-select:none}.htile:active{transform:scale(.9)}
@media(max-width:768px){.grid-2{grid-template-columns:1fr!important}.grid-3{grid-template-columns:1fr 1fr!important}.header-scores{display:none!important}}
@media(max-width:480px){.grid-3{grid-template-columns:1fr!important}.habits-grid{grid-template-columns:repeat(5,1fr)!important}}
</style>
</head>
<body>
<div id="app"></div>
<script>
const CONFIG={ws:{url:(location.hostname==='localhost'||location.hostname==='127.0.0.1')?'ws://localhost:18789':`ws://${location.hostname}:18789`,token:'312f7fb9f6518cfb7566b3278964e19d8318b9dfe687229c',session:'agent:main:main',clientId:'epiclife-control-ui'},user:{name:'Jason'}};

const VISION={mantra:"Execute. Don't Deliberate.",year:"2026 ‚Äî Year of Execution",futureself:"I am a man of deep conviction and relentless execution. I lead with integrity, build with purpose, and live with intentionality. Every decision I make comes from abundance, not scarcity. I am the founder my teams look to, the father my children admire, and the partner Rachel deserves.",affirmations:["I am building generational wealth","I am fully present for my family","I operate at peak performance","I lead with integrity and purpose","My ventures create massive value","I am disciplined, focused, unstoppable","Abundance flows through everything I build","I am becoming my highest self"]};

const DOMAINS=[
{id:"spiritual",name:"Spiritual",icon:"üßò",color:"#A78BFA",img:"https://images.unsplash.com/photo-1506905925346-21bda4d32df4?w=800&q=80",grad:"linear-gradient(135deg,#1a0533,#4c1d95)",quote:"Grounded in purpose. Connected to something greater.",brief:"Daily meditation ¬∑ Ayahuasca ceremony ¬∑ Stoic practice",score:7,target:9,goals:[{t:"Daily meditation (20 min)",p:65,ms:[{t:"30-day streak",d:1},{t:"60-day streak",d:0},{t:"Vipassana retreat",d:0}]},{t:"Ayahuasca ceremony ‚Äî deep inner work",p:40,ms:[{t:"Retreat booked May 8-10",d:1},{t:"8 participants",d:0},{t:"Integration protocol",d:0}]},{t:"Stoic philosophy daily practice",p:70,ms:[{t:"Morning journaling",d:1},{t:"Meditations re-read",d:1},{t:"Teach kids Stoicism",d:0}]}]},
{id:"health",name:"Health",icon:"üí™",color:"#10B981",img:"https://images.unsplash.com/photo-1534438327276-14e5300c3a48?w=800&q=80",grad:"linear-gradient(135deg,#022c22,#065f46)",quote:"Peak physical form. Unbreakable discipline.",brief:"185 lbs at 12% BF ¬∑ 5AM non-negotiable ¬∑ Cold plunge daily",score:6,target:9,goals:[{t:"185 lbs at 12% body fat",p:30,ms:[{t:"Under 200",d:1},{t:"Under 190",d:0},{t:"185 target",d:0}]},{t:"5AM wake ‚Äî non-negotiable",p:80,ms:[{t:"30-day streak",d:1},{t:"90-day streak",d:0}]},{t:"Cold plunge + breathwork stack",p:55,ms:[{t:"Wim Hof learned",d:1},{t:"Daily plunge",d:0},{t:"4-round protocol",d:0}]}]},
{id:"financial",name:"Financial",icon:"üí∞",color:"#F59E0B",img:"https://images.unsplash.com/photo-1486406146926-c627a92ad1ab?w=800&q=80",grad:"linear-gradient(135deg,#1c1a00,#713f12)",quote:"Abundance flows from value creation.",brief:"Cash flow command ¬∑ $2M pipeline ¬∑ $10K/mo passive",score:5,target:9,goals:[{t:"Command over spending and cash flow",p:15,ms:[{t:"YNAB active",d:1},{t:"Monthly budget set",d:0},{t:"3-month trend",d:0}]},{t:"$2M+ venture pipeline by Q3",p:20,ms:[{t:"4 territory reps",d:0},{t:"$500K pipeline",d:0},{t:"$2M pipeline",d:0}]},{t:"Passive income $10K/mo",p:10,ms:[{t:"STOIC revenue stable",d:0},{t:"First Marcus client",d:0},{t:"$10K/mo",d:0}]}]},
{id:"family",name:"Family",icon:"üë®‚Äçüë©‚Äçüëß‚Äçüë¶",color:"#3B82F6",img:"https://images.unsplash.com/photo-1511895426328-dc8714191300?w=800&q=80",grad:"linear-gradient(135deg,#0c1929,#1e40af)",quote:"Fully present. The father and partner they deserve.",brief:"Phone-free family time ¬∑ Weekly date ¬∑ Active fathering",score:7,target:10,goals:[{t:"Fully present ‚Äî no phone during family time",p:50,ms:[{t:"Phone-free dinners",d:1},{t:"Weekend mornings",d:0},{t:"Kids notice",d:0}]},{t:"Deepen partnership with Rachel",p:60,ms:[{t:"Weekly date night",d:1},{t:"Quarterly getaway",d:0},{t:"Shared vision doc",d:0}]},{t:"Active father ‚Äî coaching, teaching",p:65,ms:[{t:"Basketball involvement",d:1},{t:"Monthly adventure",d:0},{t:"Financial literacy",d:0}]}]},
{id:"business",name:"Business",icon:"üöÄ",color:"#EF4444",img:"https://images.unsplash.com/photo-1497366216548-37526070297c?w=800&q=80",grad:"linear-gradient(135deg,#1a0000,#7f1d1d)",quote:"Building empires. Leading warriors.",brief:"SkyHawk scaling ¬∑ StormKing RSA launch ¬∑ SymAssist MVP",score:6,target:9,goals:[{t:"SkyHawk ‚Äî full US sales team",p:45,ms:[{t:"4 reps hired",d:0},{t:"Pipeline cadence",d:0},{t:"First enterprise",d:0}]},{t:"Launch StormKing at RSA 2026",p:25,ms:[{t:"MVP live",d:0},{t:"5 founding vendors",d:0},{t:"RSA booth",d:0}]},{t:"Ship SymAssist MVP",p:20,ms:[{t:"Alpha build",d:0},{t:"3 beta PMs",d:0},{t:"First paying",d:0}]}]},
{id:"growth",name:"Growth",icon:"üìà",color:"#EC4899",img:"https://images.unsplash.com/photo-1493243350443-9e3048ce7288?w=800&q=80",grad:"linear-gradient(135deg,#1a0011,#831843)",quote:"Always learning. Always evolving. Never settling.",brief:"24 books ¬∑ Marcus as force multiplier ¬∑ 50-person network",score:7,target:9,goals:[{t:"Marcus as true force multiplier",p:55,ms:[{t:"Operational daily",d:1},{t:"Health check auto",d:1},{t:"Proactive insights",d:0}]},{t:"Read 24 books in 2026",p:12,ms:[{t:"6 books Q1",d:0},{t:"12 books Q2",d:0},{t:"24 books Q4",d:0}]},{t:"50 high-integrity advisory network",p:15,ms:[{t:"Vault connections",d:0},{t:"BK founding cohort",d:0},{t:"50 members",d:0}]}]}
];

// Habits ‚Äî persisted to localStorage
const HABITS_DEFAULT=[
{name:"5AM",icon:"‚òÄÔ∏è",dom:"health"},
{name:"Breathwork",icon:"ü´Å",dom:"health"},
{name:"ACIM",icon:"üìñ",dom:"spiritual"},
{name:"Meditate",icon:"üßò",dom:"spiritual"},
{name:"Exercise",icon:"üí™",dom:"health"},
{name:"Journal",icon:"üìì",dom:"spiritual"},
{name:"Read",icon:"üìö",dom:"growth"},
{name:"No Alcohol",icon:"üö´",dom:"health"},
{name:"3 Wins",icon:"üèÜ",dom:"growth"},
{name:"Gratitude",icon:"üôè",dom:"spiritual"},
];

function loadHabits(){
  const today = new Date().toISOString().slice(0,10);
  const saved = localStorage.getItem('epiclife-habits');
  if(saved){
    try{
      const d=JSON.parse(saved);
      if(d.date===today) return d.habits;
    }catch(e){}
  }
  // New day or no save ‚Äî reset all to unchecked
  return HABITS_DEFAULT.map(h=>({...h,done:false}));
}
function saveHabits(habits){
  const today = new Date().toISOString().slice(0,10);
  localStorage.setItem('epiclife-habits',JSON.stringify({date:today,habits}));
}

const VENTURES=[
{name:"SkyHawk Security",emoji:"ü¶Ö",phase:"Scaling",st:"active",prog:45,dom:"business",plan:"Build US sales team across 4 territories. Hit $2M ARR pipeline by Q3.",ms:[{t:"West rep",d:1},{t:"Florida rep",d:1},{t:"Texas rep",d:0},{t:"Boston rep",d:0},{t:"$500K pipeline",d:0},{t:"$2M pipeline",d:0}],acts:[{t:"Oodles wire ‚Äî $1,344 OVERDUE",p:"urgent",d:0,ai:0},{t:"Andrew Zeb + Noam/Mark outcome",p:"high",d:0,ai:0},{t:"Texas Army officer call (Tue)",p:"high",d:0,ai:0},{t:"John Setnicka onboarding today",p:"high",d:0,ai:0},{t:"Cedric intro to Noam/Mark",p:"medium",d:0,ai:0},{t:"Matt Foster week 1 check-in",p:"medium",d:1,ai:0},{t:"Update Salesforce territories",p:"medium",d:0,ai:1},{t:"Weekly team standup cadence",p:"low",d:0,ai:1}]},
{name:"StormKing Cyber",emoji:"‚ö°",phase:"Pre-Launch",st:"building",prog:25,dom:"business",plan:"Launch at RSA 2026. GTM Equity Swap. Chen Burshen CTO.",ms:[{t:"Architecture",d:1},{t:"GTM model",d:1},{t:"Vendor tiers",d:0},{t:"RSA booth",d:0},{t:"5 vendors",d:0}],acts:[{t:"3-tier vendor structure",p:"high",d:0,ai:0},{t:"Chen ‚Äî RSA booth strategy",p:"high",d:0,ai:0},{t:"RSA outreach ‚Äî CyberX network",p:"high",d:0,ai:0},{t:"Glilot Capital intro",p:"medium",d:0,ai:0},{t:"Map top 20 Israeli vendors",p:"medium",d:0,ai:1}]},
{name:"SymAssist",emoji:"üè†",phase:"Building",st:"building",prog:20,dom:"business",plan:"AI property management SaaS. Jeremy co-founder. Ship MVP.",ms:[{t:"Incorporated",d:1},{t:"Founders signed",d:1},{t:"Dev team",d:1},{t:"MVP spec",d:0},{t:"Alpha",d:0}],acts:[{t:"Alex & Cam status check",p:"high",d:0,ai:0},{t:"Jeremy sync Feb 25 STL",p:"high",d:0,ai:0},{t:"Product requirements review",p:"medium",d:0,ai:0}]},
{name:"Black Knight Aura",emoji:"ü§ñ",phase:"Building",st:"building",prog:15,dom:"business",plan:"AI executive coach. Dilip co-founder + Indian dev team.",ms:[{t:"Concept validated",d:1},{t:"Dev engaged",d:1},{t:"Framework",d:0},{t:"Alpha",d:0}],acts:[{t:"Dilip sprint sync",p:"high",d:0,ai:0},{t:"Coaching prompt framework v2",p:"medium",d:0,ai:0}]},
{name:"My Epic Life",emoji:"üéØ",phase:"Development",st:"building",prog:30,dom:"growth",plan:"Life OS app. Command Center = prototype. Marcus core.",ms:[{t:"V1 dashboard",d:1},{t:"Marcus integrated",d:1},{t:"V2 redesign",d:0},{t:"Beta",d:0}],acts:[{t:"Command Center v2 build",p:"high",d:0,ai:0},{t:"YNAB + health integrations",p:"medium",d:0,ai:1}]},
{name:"Black Knight Advisory",emoji:"‚ôû",phase:"Pre-Launch",st:"planning",prog:15,dom:"growth",plan:"Invitation-only fellowship. 50 founding members.",ms:[{t:"Positioning",d:1},{t:"Vault targets",d:0},{t:"Circle.so",d:0},{t:"50 members",d:0}],acts:[{t:"Vault outreach (14 targets)",p:"high",d:0,ai:0},{t:"Circle.so platform setup",p:"medium",d:0,ai:0}]},
{name:"STOIC Timepieces",emoji:"‚åö",phase:"Revenue",st:"active",prog:60,dom:"financial",plan:"Premium watch brand. Revenue generating.",ms:[{t:"Launched",d:1},{t:"Revenue",d:1},{t:"Q1 campaign",d:0}],acts:[{t:"Q1 inventory review",p:"medium",d:0,ai:0}]},
{name:"True North Labs",emoji:"üß≠",phase:"Holding Co",st:"active",prog:50,dom:"business",plan:"Holding company. Marcus productization.",ms:[{t:"Entity",d:1},{t:"Marcus v1",d:1},{t:"Arch doc",d:1},{t:"First client",d:0}],acts:[{t:"Marcus arch review",p:"high",d:0,ai:0},{t:"Entity review w/ accountant",p:"medium",d:0,ai:0}]}
];

const SPENDING={today:47.82,week:892.15,month:3241.67,cats:[{n:"Housing",a:1006,p:31,i:"üè†"},{n:"Groceries",a:678,p:21,i:"üõí"},{n:"Shopping",a:534,p:16,i:"üõç"},{n:"Food",a:423,p:13,i:"‚òï"},{n:"Transport",a:312,p:10,i:"‚õΩ"},{n:"Subs",a:289,p:9,i:"üì±"}],txns:[{m:"Starbucks",a:12.45,c:"Food & Drink",t:"7:22 AM"},{m:"Shell Gas",a:35.37,c:"Transportation",t:"Yesterday"},{m:"Amazon",a:89.99,c:"Shopping",t:"Yesterday"},{m:"Whole Foods",a:156.23,c:"Groceries",t:"Feb 14"},{m:"Apple iCloud",a:9.99,c:"Subscriptions",t:"Feb 13"}]};
const HEALTH={weight:"198.4",sleep:"6h 42m",steps:"8,241",hrv:"42"};

// ‚ïê‚ïê‚ïê STATE ‚ïê‚ïê‚ïê
let state={screen:'vision',visionExpanded:null,expandedVenture:null,showChat:false,showBrief:true,showTxns:false,showVisionText:false,habits:loadHabits(),ventureActs:{},newAct:{},chatMsgs:[],chatInput:'',affIdx:0,imgErrors:{},wsStatus:'disconnected',schedule:[],liveData:null,briefText:''};
VENTURES.forEach((v,i)=>{state.ventureActs[i]=JSON.parse(JSON.stringify(v.acts))});

// ‚ïê‚ïê‚ïê LIVE DATA ‚ïê‚ïê‚ïê
async function fetchLiveData(){
  try{
    const r=await fetch('/data.json?t='+Date.now());
    if(!r.ok) throw new Error('no data.json');
    const d=await r.json();
    state.liveData=d;
    state.schedule=d.schedule||[];
    console.log('üìÖ Live data loaded:',d.schedule?.length,'events for',d.today);
    render();
  }catch(e){
    console.warn('‚ö†Ô∏è No data.json ‚Äî using empty schedule. Run daily-data.sh to generate.');
    state.schedule=[];
  }
}
// Refresh data every 5 min
setInterval(fetchLiveData,5*60*1000);

function getBriefHeader(){
  if(state.liveData) return state.liveData.today;
  const d=new Date();
  return d.toLocaleDateString('en-US',{weekday:'long',month:'long',day:'numeric',year:'numeric'});
}

function getGreeting(){
  const h=new Date().getHours();
  if(h<5) return 'Night owl mode';
  if(h<12) return 'Good morning';
  if(h<17) return 'Good afternoon';
  if(h<21) return 'Good evening';
  return 'Night owl mode';
}

// ‚ïê‚ïê‚ïê WEBSOCKET ‚ïê‚ïê‚ïê
let ws=null,wsRT=null,pendingId=null,streamTxt='';
function connectMarcus(){if(ws&&ws.readyState<=1)return;state.wsStatus='connecting';updateWsStatus();try{ws=new WebSocket(CONFIG.ws.url)}catch(e){state.wsStatus='disconnected';render();schRe();return}
ws.onopen=()=>{ws.send(JSON.stringify({type:'req',id:'c1',method:'connect',params:{minProtocol:3,maxProtocol:3,client:{id:CONFIG.ws.clientId,version:'2.0',platform:'web',mode:'webchat',instanceId:'el-'+Date.now()},role:'operator',scopes:['operator.admin'],caps:[],auth:{token:CONFIG.ws.token}}}))};
ws.onmessage=(evt)=>{let m;try{m=JSON.parse(evt.data)}catch(e){return}
if(m.type==='event'&&m.event==='connect.challenge'){ws.send(JSON.stringify({type:'req',id:'c2',method:'connect',params:{minProtocol:3,maxProtocol:3,client:{id:CONFIG.ws.clientId,version:'2.0',platform:'web',mode:'webchat',instanceId:'el-'+Date.now()},role:'operator',scopes:['operator.admin'],caps:[],auth:{token:CONFIG.ws.token}}}));return}
if(m.type==='res'&&m.ok&&m.payload?.type==='hello-ok'){state.wsStatus='connected';updateWsStatus();return}
if(m.type==='res'&&m.id===pendingId&&!m.ok){state.chatMsgs.push({r:'a',t:'‚ö†Ô∏è Error sending.'});render();return}
if(m.type==='event'&&m.event==='chat'){const p=m.payload||{};let t='';if(p.message?.content){for(const b of p.message.content){if(b.type==='text'&&b.text)t+=b.text}}else if(p.text)t=p.text;else if(typeof p.content==='string')t=p.content;if(!t)return;const s=p.state||p.message?.state||'';if(s==='delta'){streamTxt+=t;const l=state.chatMsgs[state.chatMsgs.length-1];if(l?.r==='a'&&l.streaming)l.t=streamTxt;else state.chatMsgs.push({r:'a',t:streamTxt,streaming:true});render()}else if(s==='final'){const l=state.chatMsgs[state.chatMsgs.length-1];if(l?.r==='a'&&l.streaming){l.t=t;l.streaming=false}else state.chatMsgs.push({r:'a',t:t});streamTxt='';render()}else{state.chatMsgs.push({r:'a',t:t});render()}}};
ws.onerror=()=>{state.wsStatus='disconnected';updateWsStatus();};ws.onclose=()=>{state.wsStatus='disconnected';updateWsStatus();schRe()}}
function schRe(){if(wsRT)clearTimeout(wsRT);wsRT=setTimeout(connectMarcus,5000)}
function sendMsg(t){if(!t.trim())return;state.chatMsgs.push({r:'u',t:t});state.chatInput='';streamTxt='';render();if(!ws||ws.readyState!==1){state.chatMsgs.push({r:'a',t:'‚ö†Ô∏è Reconnecting...'});render();connectMarcus();return}pendingId='m'+Date.now();ws.send(JSON.stringify({type:'req',id:pendingId,method:'chat.send',params:{sessionKey:CONFIG.ws.session,message:t.trim(),idempotencyKey:String(Date.now())}}))}

// ‚ïê‚ïê‚ïê HELPERS ‚ïê‚ïê‚ïê
function h(tag,attrs,...ch){const el=document.createElement(tag);if(attrs)for(const[k,v]of Object.entries(attrs)){if(k==='style'&&typeof v==='object')Object.assign(el.style,v);else if(k==='className')el.className=v;else if(k.startsWith('on'))el.addEventListener(k.slice(2).toLowerCase(),v);else if(k==='innerHTML')el.innerHTML=v;else el.setAttribute(k,v)}for(const c of ch){if(c==null)continue;if(typeof c==='string'||typeof c==='number')el.appendChild(document.createTextNode(c));else if(Array.isArray(c))c.forEach(x=>x&&el.appendChild(x));else el.appendChild(c)}return el}
const pc=p=>p==='urgent'?'#EF4444':p==='high'?'#F59E0B':p==='medium'?'#3B82F6':'#6B7084';
const pl=p=>p==='urgent'?'!':p==='high'?'H':p==='medium'?'M':'L';
const lifeScore=()=>Math.round(DOMAINS.reduce((s,d)=>s+d.score,0)/DOMAINS.length*10)/10;
const hDone=()=>state.habits.filter(h=>h.done).length;
const totalOpen=()=>VENTURES.reduce((s,_,i)=>(s+(state.ventureActs[i]||[]).filter(a=>!a.d).length),0);

// ‚ïê‚ïê‚ïê HEADER ‚ïê‚ïê‚ïê
function renderHeader(){
const sc=state.wsStatus==='connected'?'#10B981':state.wsStatus==='connecting'?'#F59E0B':'#EF4444';
const st=state.wsStatus==='connected'?'ONLINE':state.wsStatus==='connecting'?'‚Ä¶':'OFFLINE';
return h('div',{style:{borderBottom:'1px solid var(--border)',padding:'12px 24px',display:'flex',justifyContent:'space-between',alignItems:'center',position:'sticky',top:'0',zIndex:'50',background:'#07070Cf0',backdropFilter:'blur(16px)'}},
h('div',{style:{display:'flex',alignItems:'center',gap:'10px'}},h('div',{style:{width:'30px',height:'30px',borderRadius:'7px',background:'linear-gradient(135deg,#C9A227,#8B6914)',display:'flex',alignItems:'center',justifyContent:'center',fontSize:'14px'}},'‚öî'),h('span',{style:{fontSize:'15px',fontWeight:'700',color:'#C9A227',letterSpacing:'.05em'}},'EPICLIFE')),
h('div',{style:{display:'flex',gap:'6px',alignItems:'center'}},
...['vision','command'].map(s=>h('button',{onClick:()=>{state.screen=s;render()},style:{background:state.screen===s?'#C9A22720':'transparent',border:`1px solid ${state.screen===s?'#C9A22740':'var(--border)'}`,borderRadius:'8px',padding:'6px 16px',color:state.screen===s?'#C9A227':'var(--text3)',fontSize:'11px',fontWeight:'700',letterSpacing:'.04em'}},s==='vision'?'üåü VISION':'‚öî COMMAND')),
h('div',{style:{width:'1px',height:'20px',background:'var(--border)',margin:'0 6px'}}),
h('div',{className:'ws-label',style:{fontSize:'10px',color:sc,display:'flex',alignItems:'center',gap:'4px',fontWeight:'600'}},h('div',{className:'ws-dot',style:{width:'6px',height:'6px',borderRadius:'3px',background:sc,animation:state.wsStatus==='connected'?'pulse 2s infinite':'none'}}),st),
h('button',{onClick:()=>{state.showChat=!state.showChat;render()},style:{background:state.showChat?'#C9A227':'transparent',border:`1px solid ${state.showChat?'#C9A227':'var(--border)'}`,borderRadius:'8px',padding:'6px 14px',color:state.showChat?'#07070C':'#C9A227',fontSize:'11px',fontWeight:'700',marginLeft:'4px'}},'‚öî Marcus')))}

// ‚ïê‚ïê‚ïê VISION ‚ïê‚ïê‚ïê
function renderVision(){
const c=h('div',{style:{minHeight:'calc(100vh - 56px)'}});
const hero=h('div',{style:{position:'relative',padding:'60px 40px 30px',textAlign:'center',overflow:'hidden'}});
hero.appendChild(h('div',{style:{position:'absolute',top:'50%',left:'50%',transform:'translate(-50%,-50%)',width:'400px',height:'400px',borderRadius:'50%',background:'radial-gradient(circle,#C9A22708 0%,transparent 70%)',animation:'breathe 8s ease-in-out infinite',pointerEvents:'none'}}));
const inner=h('div',{style:{position:'relative',zIndex:'2',animation:'fadeUp .6s ease'}});
inner.appendChild(h('div',{style:{fontSize:'11px',fontWeight:'700',color:'#C9A22780',letterSpacing:'.2em',marginBottom:'16px'}},'YOUR FUTURE SELF'));
inner.appendChild(h('div',{className:'serif',style:{fontSize:'42px',fontWeight:'700',lineHeight:'1.2',maxWidth:'640px',margin:'0 auto 18px'}},h('span',{className:'gold-shim'},VISION.mantra)));
const fs=h('div',{onClick:()=>{state.showVisionText=!state.showVisionText;render()},style:{cursor:'pointer',maxWidth:'560px',margin:'0 auto 24px'}});
if(state.showVisionText)fs.appendChild(h('div',{style:{fontSize:'15px',color:'var(--text2)',lineHeight:'1.8',fontStyle:'italic',animation:'fadeIn .3s ease',padding:'12px 20px',background:'var(--card)',borderRadius:'10px',border:'1px solid var(--border)'}},VISION.futureself));
else fs.appendChild(h('div',{style:{fontSize:'13px',color:'var(--text3)',fontStyle:'italic'}},'Tap to read your Future Self statement ‚Üì'));
inner.appendChild(fs);
const aff=h('div',{style:{height:'28px',position:'relative',marginBottom:'22px'}});
aff.appendChild(h('div',{style:{position:'absolute',width:'100%',textAlign:'center',animation:'affirmRotate 4s ease both'}},h('span',{style:{fontSize:'13px',fontWeight:'600',color:'#C9A227',letterSpacing:'.04em'}},'‚ú¶ '+VISION.affirmations[state.affIdx]+' ‚ú¶')));
inner.appendChild(aff);
const sb=h('div',{style:{display:'inline-flex',alignItems:'center',gap:'16px',background:'var(--card)',border:'1px solid var(--border)',borderRadius:'14px',padding:'12px 24px'}});
sb.appendChild(h('div',{},h('div',{style:{fontSize:'8px',color:'var(--text3)',letterSpacing:'.1em',fontWeight:'600'}},'LIFE SCORE'),h('div',{className:'mono',style:{fontSize:'30px',fontWeight:'700',color:'#C9A227'}},String(lifeScore()))));
sb.appendChild(h('div',{style:{width:'1px',height:'36px',background:'var(--border)'}}));
const ic=h('div',{style:{display:'flex',gap:'4px'}});DOMAINS.forEach(d=>{ic.appendChild(h('div',{style:{width:'18px',height:'18px',borderRadius:'4px',background:d.color+'18',border:`1px solid ${d.color}25`,display:'flex',alignItems:'center',justifyContent:'center',fontSize:'10px'}},d.icon))});sb.appendChild(ic);
sb.appendChild(h('div',{style:{width:'1px',height:'36px',background:'var(--border)'}}));
sb.appendChild(h('button',{onClick:()=>{state.screen='command';render()},style:{background:'#C9A22720',border:'1px solid #C9A22740',borderRadius:'8px',padding:'10px 20px',color:'#C9A227',fontSize:'12px',fontWeight:'700',letterSpacing:'.04em'}},'EXECUTE ‚Üí'));
inner.appendChild(sb);hero.appendChild(inner);c.appendChild(hero);
const tw=h('div',{style:{padding:'10px 24px 50px',maxWidth:'1020px',margin:'0 auto'}});
const isExp=state.visionExpanded!==null;
const grid=h('div',{className:'grid-3',style:{display:'grid',gridTemplateColumns:isExp?'1fr':'repeat(3,1fr)',gap:'10px'}});
DOMAINS.forEach((d,i)=>{if(isExp&&state.visionExpanded!==i)return;const ie=state.visionExpanded===i;
const tile=h('div',{className:'vtile',onClick:()=>{state.visionExpanded=ie?null:i;render()},style:{minHeight:ie?'420px':'270px',animation:`fadeUp .5s ease ${i*.08}s both`}});
if(!state.imgErrors[i]){const img=h('img',{src:d.img,style:{position:'absolute',inset:'0',width:'100%',height:'100%',objectFit:'cover',borderRadius:'14px'}});img.onerror=()=>{state.imgErrors[i]=true;render()};tile.appendChild(img)}else tile.appendChild(h('div',{style:{position:'absolute',inset:'0',background:d.grad,borderRadius:'14px'}}));
tile.appendChild(h('div',{className:'vov',style:{position:'absolute',inset:'0',background:`linear-gradient(180deg,${d.color}08 0%,#07070Cee 100%)`,opacity:ie?'.5':'.6',borderRadius:'14px'}}));
tile.appendChild(h('div',{style:{position:'absolute',bottom:'0',left:'0',right:'0',height:'65%',background:'linear-gradient(transparent,#07070Cee)',borderRadius:'0 0 14px 14px'}}));
const ct=h('div',{style:{position:'absolute',inset:'0',display:'flex',flexDirection:'column',justifyContent:'flex-end',padding:ie?'30px':'20px'}});
ct.appendChild(h('div',{style:{position:'absolute',top:'14px',right:'14px',background:'#07070C90',backdropFilter:'blur(6px)',borderRadius:'8px',padding:'6px 10px',border:`1px solid ${d.color}30`}},h('div',{className:'mono',style:{fontSize:'18px',fontWeight:'700',color:d.color}},String(d.score)),h('div',{style:{fontSize:'7px',color:'var(--text3)',textAlign:'center',fontWeight:'500'}},'/'+d.target)));
ct.appendChild(h('span',{style:{fontSize:ie?'36px':'26px',marginBottom:ie?'10px':'6px',filter:'drop-shadow(0 2px 8px rgba(0,0,0,.5))'}},d.icon));
ct.appendChild(h('div',{className:'serif',style:{fontSize:ie?'28px':'18px',fontWeight:'700',color:'#fff',marginBottom:ie?'8px':'4px',textShadow:'0 2px 10px rgba(0,0,0,.5)'}},d.name));
ct.appendChild(h('div',{style:{fontSize:ie?'15px':'12px',color:'#ddd',fontStyle:'italic',lineHeight:'1.5'}},'"'+d.quote+'"'));
if(!ie)ct.appendChild(h('div',{style:{fontSize:'10px',color:'#999',marginTop:'5px',lineHeight:'1.4'}},d.brief));
if(ie){const det=h('div',{style:{animation:'fadeUp .3s ease',marginTop:'14px'}});det.onclick=e=>e.stopPropagation();
d.goals.forEach(g=>{const gEl=h('div',{style:{marginBottom:'10px',padding:'12px 14px',background:'#07070C60',backdropFilter:'blur(6px)',borderRadius:'10px',borderLeft:`3px solid ${d.color}60`}});
gEl.appendChild(h('div',{style:{display:'flex',justifyContent:'space-between',marginBottom:'5px'}},h('span',{style:{fontSize:'13px',fontWeight:'600',color:'#D1D5DB'}},g.t),h('span',{className:'mono',style:{fontSize:'12px',fontWeight:'700',color:d.color}},g.p+'%')));
gEl.appendChild(h('div',{style:{height:'4px',background:'#1A1A2880',borderRadius:'3px',marginBottom:'7px',overflow:'hidden'}},h('div',{style:{width:g.p+'%',height:'100%',background:`linear-gradient(90deg,${d.color}80,${d.color})`,borderRadius:'3px'}})));
const mw=h('div',{style:{display:'flex',flexWrap:'wrap',gap:'4px'}});g.ms.forEach(m=>{mw.appendChild(h('span',{style:{fontSize:'9px',padding:'3px 7px',borderRadius:'4px',background:m.d?d.color+'18':'#0A0A14',color:m.d?d.color:'#666',border:`1px solid ${m.d?d.color+'25':'#1A1A2850'}`,fontWeight:'500'}},(m.d?'‚úì ':'‚óã ')+m.t))});gEl.appendChild(mw);det.appendChild(gEl)});ct.appendChild(det)}
tile.appendChild(ct);grid.appendChild(tile)});tw.appendChild(grid);
if(!isExp)tw.appendChild(h('div',{style:{textAlign:'center',padding:'28px 0',animation:'fadeUp .6s ease .6s both'}},h('div',{style:{fontSize:'10px',color:'var(--muted)',letterSpacing:'.15em'}},'TAP ANY DOMAIN TO EXPLORE')));
c.appendChild(tw);return c}

// ‚ïê‚ïê‚ïê COMMAND ‚ïê‚ïê‚ïê
function renderCommand(){
const w=h('div',{style:{maxWidth:'1100px',margin:'0 auto',padding:'18px 22px'}});
// North Star
const ns=h('div',{onClick:()=>{state.screen='vision';render()},style:{display:'flex',alignItems:'center',justifyContent:'space-between',padding:'10px 16px',background:'var(--card)',border:'1px solid #C9A22720',borderRadius:'10px',marginBottom:'16px',cursor:'pointer',animation:'fadeUp .3s ease'}});
ns.appendChild(h('div',{style:{display:'flex',alignItems:'center',gap:'10px'}},h('span',{style:{fontSize:'16px'}},'üåü'),h('span',{style:{fontSize:'11px',fontWeight:'700',color:'#C9A22790',letterSpacing:'.06em'}},VISION.year.toUpperCase()),h('span',{style:{fontSize:'12px',color:'var(--text3)',fontStyle:'italic'}},'"'+VISION.mantra+'"')));
const nr=h('div',{className:'header-scores',style:{display:'flex',alignItems:'center',gap:'10px'}});
DOMAINS.forEach(d=>{nr.appendChild(h('div',{style:{display:'flex',alignItems:'center',gap:'3px'}},h('span',{style:{fontSize:'11px'}},d.icon),h('span',{className:'mono',style:{fontSize:'10px',fontWeight:'700',color:d.color}},String(d.score))))});
nr.appendChild(h('div',{style:{width:'1px',height:'16px',background:'var(--border)',margin:'0 4px'}}));
nr.appendChild(h('span',{className:'mono',style:{fontSize:'14px',fontWeight:'700',color:'#C9A227'}},String(lifeScore())));
ns.appendChild(nr);w.appendChild(ns);

// Brief ‚Äî dynamic date
if(state.showBrief){const b=h('div',{className:'card',style:{padding:'14px 18px',marginBottom:'16px',borderLeft:'4px solid #C9A227',position:'relative',animation:'fadeUp .3s ease .05s both'}});
b.appendChild(h('button',{onClick:()=>{state.showBrief=false;render()},style:{position:'absolute',top:'8px',right:'10px',background:'none',border:'none',color:'var(--text3)',fontSize:'14px'}},'‚úï'));
b.appendChild(h('div',{style:{fontSize:'11px',fontWeight:'700',color:'#C9A227',letterSpacing:'.06em',marginBottom:'6px'}},'‚öî MARCUS ¬∑ '+getBriefHeader()));
if(state.briefText){
  b.appendChild(h('div',{innerHTML:state.briefText.replace(/\n/g,'<br>'),style:{fontSize:'13px',lineHeight:'1.7',color:'var(--text2)'}}));
}else{
  b.appendChild(h('div',{style:{fontSize:'13px',color:'var(--text3)',fontStyle:'italic'}},'Open Marcus chat to request today\'s brief ‚Üí'));
}
w.appendChild(b)}
else w.appendChild(h('button',{onClick:()=>{state.showBrief=true;render()},style:{background:'var(--card)',border:'1px solid var(--border)',borderRadius:'8px',padding:'6px 14px',color:'#C9A227',fontSize:'10px',fontWeight:'700',marginBottom:'14px'}},'‚öî Show Brief'));

// Habits + Calendar
const tg=h('div',{className:'grid-2',style:{display:'grid',gridTemplateColumns:'1fr 1fr',gap:'14px',marginBottom:'18px',animation:'fadeUp .3s ease .1s both'}});
const hc=h('div',{className:'card',style:{padding:'16px 18px'}});
const hh=h('div',{style:{display:'flex',justifyContent:'space-between',alignItems:'center',marginBottom:'10px'}});
hh.appendChild(h('div',{className:'sec-label'},h('span',{className:'dot'}),h('span',{},'Daily Habits')));
const hdn=hDone();hh.appendChild(h('span',{className:'mono',style:{fontSize:'14px',fontWeight:'700',color:hdn>=8?'#10B981':hdn>=5?'#C9A227':'var(--text3)'}},hdn+'/'+state.habits.length));hc.appendChild(hh);
const hb=h('div',{style:{height:'3px',background:'var(--dim)',borderRadius:'3px',marginBottom:'12px',overflow:'hidden'}});
hb.appendChild(h('div',{style:{height:'100%',width:(hdn/state.habits.length*100)+'%',background:`linear-gradient(90deg,#C9A227,${hdn>=8?'#10B981':'#C9A227'})`,borderRadius:'3px',transition:'width .3s'}}));hc.appendChild(hb);
const hg=h('div',{className:'habits-grid',style:{display:'grid',gridTemplateColumns:'repeat(5,1fr)',gap:'6px'}});
state.habits.forEach((hab,i)=>{hg.appendChild(h('div',{className:'htile',onClick:()=>{state.habits[i].done=!state.habits[i].done;saveHabits(state.habits);render()},style:{display:'flex',flexDirection:'column',alignItems:'center',gap:'3px',padding:'10px 4px',borderRadius:'8px',background:hab.done?'#10B98112':'#0A0A14',border:`1px solid ${hab.done?'#10B98120':'var(--dim)'}`,transition:'all .15s'}},h('span',{style:{fontSize:'18px',filter:hab.done?'none':'grayscale(1) opacity(.3)'}},hab.icon),h('span',{style:{fontSize:'9px',color:hab.done?'#10B981':'var(--muted)',fontWeight:'600'}},hab.name)))});hc.appendChild(hg);tg.appendChild(hc);

// Calendar ‚Äî LIVE from data.json
const cc=h('div',{className:'card',style:{padding:'16px 18px'}});
cc.appendChild(h('div',{className:'sec-label',style:{marginBottom:'10px'}},h('span',{className:'dot'}),h('span',{},"Today's Schedule")));
if(state.schedule.length===0){
  cc.appendChild(h('div',{style:{fontSize:'12px',color:'var(--text3)',fontStyle:'italic',padding:'16px 0',textAlign:'center'}},'Run daily-data.sh to load today\'s calendar'));
}else{
state.schedule.forEach((ev,i)=>{const r=h('div',{style:{display:'flex',alignItems:'center',gap:'8px',padding:'7px 6px',borderBottom:i<state.schedule.length-1?'1px solid var(--dim)':'none',background:ev.now?'#C9A22708':'transparent',borderRadius:ev.now?'6px':'0'}});
r.appendChild(h('span',{className:'mono',style:{fontSize:'11px',color:ev.now?'#C9A227':'var(--text3)',width:'60px',flexShrink:'0',fontWeight:ev.now?'700':'400'}},ev.time));
r.appendChild(h('div',{style:{width:'3px',height:'16px',borderRadius:'2px',background:ev.color,flexShrink:'0'}}));
const evInfo=h('div',{style:{flex:'1'}});
evInfo.appendChild(h('span',{style:{fontSize:'13px',fontWeight:ev.now?'600':'400',color:ev.now?'var(--text)':'var(--text2)',display:'block'}},ev.title));
if(ev.location)evInfo.appendChild(h('span',{style:{fontSize:'9px',color:'var(--text3)'}},ev.location));
r.appendChild(evInfo);
if(ev.now)r.appendChild(h('span',{style:{fontSize:'8px',color:'#C9A227',fontWeight:'700',background:'#C9A22715',padding:'2px 6px',borderRadius:'3px'}},'NOW'));
cc.appendChild(r)});}
tg.appendChild(cc);w.appendChild(tg);

// Ventures
const vs=h('div',{style:{marginBottom:'18px',animation:'fadeUp .3s ease .15s both'}});
const vh=h('div',{style:{display:'flex',justifyContent:'space-between',alignItems:'center',marginBottom:'10px'}});
vh.appendChild(h('div',{className:'sec-label'},h('span',{className:'dot'}),h('span',{},'Ventures')));
vh.appendChild(h('span',{style:{fontSize:'11px',color:'var(--text3)',fontWeight:'500'}},totalOpen()+' open actions'));vs.appendChild(vh);
const vc=h('div',{className:'card',style:{overflow:'hidden'}});
VENTURES.forEach((v,vi)=>{const isO=state.expandedVenture===vi;const acts=state.ventureActs[vi]||v.acts;
const open=[...acts.filter(a=>!a.d)].sort((a,b)=>{const o={urgent:0,high:1,medium:2,low:3};return o[a.p]-o[b.p]});
const done=acts.filter(a=>a.d);const t3=open.slice(0,3);const dc=DOMAINS.find(d=>d.id===v.dom)?.color||'var(--text3)';
const ve=h('div',{style:{borderBottom:vi<VENTURES.length-1?'1px solid var(--dim)':'none'}});
const row=h('div',{className:'vrow',onClick:()=>{state.expandedVenture=isO?null:vi;render()},style:{display:'flex',alignItems:'center',padding:'12px 16px',gap:'10px'}});
row.appendChild(h('span',{style:{fontSize:'18px'}},v.emoji));
const rm=h('div',{style:{flex:'1',minWidth:'0'}});
const nr2=h('div',{style:{display:'flex',alignItems:'center',gap:'6px'}});
nr2.appendChild(h('span',{style:{fontSize:'14px',fontWeight:'700',color:'var(--text)'}},v.name));
const phc=v.st==='active'?'#10B981':v.st==='building'?'#3B82F6':'#8B5CF6';
nr2.appendChild(h('span',{style:{fontSize:'8px',fontWeight:'700',color:phc,background:phc+'12',padding:'2px 7px',borderRadius:'3px',letterSpacing:'.03em'}},v.phase.toUpperCase()));rm.appendChild(nr2);
if(!isO&&t3.length){const pills=h('div',{style:{display:'flex',gap:'4px',marginTop:'3px',flexWrap:'wrap'}});
t3.forEach(a=>{pills.appendChild(h('span',{style:{fontSize:'10px',color:'var(--text2)',background:'#0A0A14',padding:'2px 8px',borderRadius:'3px',borderLeft:`2px solid ${pc(a.p)}`,maxWidth:'200px',overflow:'hidden',textOverflow:'ellipsis',whiteSpace:'nowrap'}},a.t))});
if(open.length>3)pills.appendChild(h('span',{style:{fontSize:'9px',color:'#C9A227',fontWeight:'600'}},'+' + (open.length-3)));rm.appendChild(pills)}
row.appendChild(rm);
const rr=h('div',{style:{display:'flex',alignItems:'center',gap:'8px',flexShrink:'0'}});
const bar=h('div',{style:{width:'50px',height:'4px',background:'var(--dim)',borderRadius:'3px',overflow:'hidden'}});
bar.appendChild(h('div',{style:{height:'100%',width:v.prog+'%',background:v.prog>50?'#10B981':v.prog>25?'#3B82F6':'#C9A227',borderRadius:'3px'}}));rr.appendChild(bar);
rr.appendChild(h('span',{className:'mono',style:{fontSize:'10px',color:'var(--text3)',width:'28px'}},v.prog+'%'));
rr.appendChild(h('span',{style:{fontSize:'10px',color:'var(--muted)',transition:'transform .2s',transform:isO?'rotate(180deg)':'none'}},'‚ñæ'));row.appendChild(rr);ve.appendChild(row);
if(isO){const det=h('div',{style:{padding:'0 16px 16px 50px',animation:'fadeUp .15s ease'}});
const pb=h('div',{style:{fontSize:'12px',color:'var(--text2)',lineHeight:'1.6',padding:'10px 14px',background:'#0A0A14',borderRadius:'8px',borderLeft:`3px solid ${dc}40`,marginBottom:'10px'}});
pb.appendChild(h('span',{style:{fontSize:'9px',fontWeight:'700',color:dc,letterSpacing:'.06em',display:'block',marginBottom:'3px'}},'PLAN'));pb.appendChild(document.createTextNode(v.plan));det.appendChild(pb);
const mw=h('div',{style:{display:'flex',flexWrap:'wrap',gap:'4px',marginBottom:'10px'}});
v.ms.forEach(m=>{mw.appendChild(h('span',{style:{fontSize:'9px',padding:'3px 8px',borderRadius:'3px',background:m.d?'#10B98112':'#0A0A14',color:m.d?'#10B981':'var(--muted)',border:`1px solid ${m.d?'#10B98118':'var(--dim)'}`,fontWeight:'500'}},(m.d?'‚úì ':'‚óã ')+m.t))});det.appendChild(mw);
det.appendChild(h('div',{style:{fontSize:'10px',fontWeight:'700',color:'var(--text3)',letterSpacing:'.04em',marginBottom:'6px'}},'ACTIONS ('+open.length+' open ¬∑ '+done.length+' done)'));
open.forEach(a=>{const oi=acts.indexOf(a);const ar=h('div',{style:{display:'flex',alignItems:'flex-start',gap:'8px',padding:'6px 0',borderBottom:'1px solid #0C0C18'}});
ar.appendChild(h('div',{onClick:e=>{e.stopPropagation();acts[oi].d=1;render()},style:{width:'14px',height:'14px',borderRadius:'4px',border:`2px solid ${pc(a.p)}`,flexShrink:'0',marginTop:'2px',cursor:'pointer'}}));
const tx=h('span',{style:{fontSize:'12px',color:'var(--text2)',lineHeight:'1.5',flex:'1'}},a.t);
if(a.ai)tx.appendChild(h('span',{style:{fontSize:'8px',color:'#C9A227',background:'#C9A22712',padding:'1px 4px',borderRadius:'3px',marginLeft:'4px',fontWeight:'700'}},'AI'));
ar.appendChild(tx);ar.appendChild(h('span',{style:{fontSize:'8px',fontWeight:'700',color:pc(a.p),background:pc(a.p)+'12',padding:'2px 5px',borderRadius:'3px',flexShrink:'0'}},pl(a.p)));det.appendChild(ar)});
if(done.length){det.appendChild(h('div',{style:{marginTop:'8px',fontSize:'9px',color:'var(--muted)',fontWeight:'600'}},'DONE ('+done.length+')'));
done.forEach(a=>{const oi=acts.indexOf(a);det.appendChild(h('div',{style:{display:'flex',alignItems:'center',gap:'8px',padding:'3px 0'}},h('div',{onClick:e=>{e.stopPropagation();acts[oi].d=0;render()},style:{width:'14px',height:'14px',borderRadius:'4px',background:'#10B981',flexShrink:'0',display:'flex',alignItems:'center',justifyContent:'center',fontSize:'8px',color:'#fff',cursor:'pointer'}},'‚úì'),h('span',{style:{fontSize:'11px',color:'var(--muted)',textDecoration:'line-through'}},a.t)))})}
const addR=h('div',{style:{display:'flex',gap:'6px',marginTop:'8px'}});
const addI=h('input',{placeholder:'+ Add action...',value:state.newAct[vi]||'',style:{flex:'1',background:'#0A0A14',border:'1px solid var(--border)',borderRadius:'6px',padding:'6px 10px',color:'var(--text)',fontSize:'11px'}});
addI.onclick=e=>e.stopPropagation();addI.oninput=e=>{state.newAct[vi]=e.target.value};
addI.onkeydown=e=>{if(e.key==='Enter'){acts.push({t:state.newAct[vi],p:'medium',d:0,ai:0});state.newAct[vi]='';render()}};addR.appendChild(addI);
addR.appendChild(h('button',{onClick:e=>{e.stopPropagation();if(state.newAct[vi]?.trim()){acts.push({t:state.newAct[vi],p:'medium',d:0,ai:0});state.newAct[vi]='';render()}},style:{background:'var(--border)',border:'none',borderRadius:'6px',padding:'6px 12px',color:'#C9A227',fontSize:'10px',fontWeight:'700'}},'Add'));
det.appendChild(addR);ve.appendChild(det)}vc.appendChild(ve)});vs.appendChild(vc);w.appendChild(vs);

// Cash Flow + Health
const bg=h('div',{className:'grid-2',style:{display:'grid',gridTemplateColumns:'1fr 1fr',gap:'14px',marginBottom:'80px',animation:'fadeUp .3s ease .2s both'}});
const cf=h('div',{className:'card',style:{padding:'16px 18px'}});
const cfh=h('div',{style:{display:'flex',justifyContent:'space-between',alignItems:'center',marginBottom:'12px'}});
cfh.appendChild(h('div',{className:'sec-label'},h('span',{className:'dot'}),h('span',{},'Cash Flow')));
cfh.appendChild(h('button',{onClick:()=>{state.showTxns=!state.showTxns;render()},style:{fontSize:'9px',color:'#C9A227',background:'#C9A22712',border:'1px solid #C9A22720',borderRadius:'4px',padding:'3px 8px',fontWeight:'700'}},state.showTxns?'CATEGORIES':'TXNS'));cf.appendChild(cfh);
const cs=h('div',{style:{display:'flex',gap:'6px',marginBottom:'14px'}});
[{l:'TODAY',v:SPENDING.today},{l:'WEEK',v:SPENDING.week},{l:'MONTH',v:SPENDING.month}].forEach(s=>{cs.appendChild(h('div',{style:{flex:'1',background:'#0A0A14',borderRadius:'8px',padding:'10px',textAlign:'center',border:'1px solid var(--dim)'}},h('div',{style:{fontSize:'8px',color:'var(--text3)',letterSpacing:'.08em',marginBottom:'3px',fontWeight:'600'}},s.l),h('div',{className:'mono',style:{fontSize:'16px',fontWeight:'700',color:'var(--text)'}},'$'+s.v.toLocaleString())))});cf.appendChild(cs);
if(!state.showTxns){SPENDING.cats.forEach(cat=>{const cr=h('div',{style:{display:'flex',alignItems:'center',gap:'6px',marginBottom:'6px'}});
cr.appendChild(h('span',{style:{fontSize:'12px',width:'16px'}},cat.i));cr.appendChild(h('span',{style:{fontSize:'11px',color:'var(--text2)',width:'64px',fontWeight:'500'}},cat.n));
const cb=h('div',{style:{flex:'1',height:'4px',background:'var(--dim)',borderRadius:'3px',overflow:'hidden'}});
cb.appendChild(h('div',{style:{width:cat.p+'%',height:'100%',background:cat.p>25?'#EF4444':cat.p>15?'#F59E0B':'#3B82F6',borderRadius:'3px'}}));cr.appendChild(cb);
cr.appendChild(h('span',{className:'mono',style:{fontSize:'10px',color:'var(--text3)',width:'42px',textAlign:'right'}},'$'+cat.a));cf.appendChild(cr)})}
else{SPENDING.txns.forEach((t,i)=>{const tr=h('div',{style:{display:'flex',justifyContent:'space-between',padding:'6px 0',borderBottom:i<SPENDING.txns.length-1?'1px solid var(--dim)':'none'}});
tr.appendChild(h('div',{},h('div',{style:{fontSize:'12px',fontWeight:'500',color:'var(--text)'}},t.m),h('div',{style:{fontSize:'9px',color:'var(--text3)'}},t.c+' ¬∑ '+t.t)));
tr.appendChild(h('span',{className:'mono',style:{fontSize:'12px',fontWeight:'600',color:'#EF4444'}},'-$'+t.a.toFixed(2)));cf.appendChild(tr)})}bg.appendChild(cf);
const hlth=h('div',{className:'card',style:{padding:'16px 18px'}});
hlth.appendChild(h('div',{className:'sec-label',style:{marginBottom:'12px'}},h('span',{className:'dot'}),h('span',{},'Health')));
const hgr=h('div',{style:{display:'grid',gridTemplateColumns:'1fr 1fr',gap:'6px',marginBottom:'12px'}});
[{l:'WEIGHT',v:HEALTH.weight,u:' lbs',i:'‚öñÔ∏è'},{l:'SLEEP',v:HEALTH.sleep,u:'',i:'üò¥'},{l:'STEPS',v:HEALTH.steps,u:'',i:'üö∂'},{l:'HRV',v:HEALTH.hrv,u:' ms',i:'‚ù§Ô∏è'}].forEach(m=>{
hgr.appendChild(h('div',{style:{background:'#0A0A14',borderRadius:'8px',padding:'12px',border:'1px solid var(--dim)'}},h('div',{style:{fontSize:'8px',color:'var(--text3)',letterSpacing:'.08em',marginBottom:'4px',fontWeight:'600'}},m.i+' '+m.l),h('div',{className:'mono',style:{fontSize:'20px',fontWeight:'700',color:'var(--text)'}},m.v,h('span',{style:{fontSize:'10px',color:'var(--muted)'}},m.u))))});hlth.appendChild(hgr);
const sw=h('div',{style:{paddingTop:'10px',borderTop:'1px solid var(--dim)'}});
sw.appendChild(h('div',{style:{fontSize:'9px',fontWeight:'700',color:'var(--text3)',letterSpacing:'.06em',marginBottom:'4px'}},'SYSTEMS'));
const stags=h('div',{style:{display:'flex',flexWrap:'wrap',gap:'3px'}});
['Gateway','Calendar','Email','iMessage','Search','CRM'].forEach(s=>{stags.appendChild(h('span',{style:{fontSize:'8px',color:'#10B981',background:'#10B98108',padding:'2px 6px',borderRadius:'3px',border:'1px solid #10B98110'}},'‚óè '+s))});
sw.appendChild(stags);hlth.appendChild(sw);bg.appendChild(hlth);w.appendChild(bg);return w}

// ‚ïê‚ïê‚ïê CHAT ‚ïê‚ïê‚ïê
function renderChat(){if(!state.showChat)return null;
const p=h('div',{style:{position:'fixed',bottom:'16px',right:'16px',width:'360px',height:'480px',background:'#0C0C16',border:'2px solid #C9A22730',borderRadius:'14px',display:'flex',flexDirection:'column',zIndex:'100',boxShadow:'0 16px 48px rgba(0,0,0,.6),0 0 0 1px #C9A22710',animation:'fadeUp .15s ease'}});
const hd=h('div',{style:{padding:'12px 16px',borderBottom:'1px solid var(--border)',display:'flex',alignItems:'center',gap:'8px',background:'#10101A',borderRadius:'14px 14px 0 0'}});
const sd=state.wsStatus==='connected'?'#10B981':state.wsStatus==='connecting'?'#F59E0B':'#EF4444';
hd.appendChild(h('div',{style:{width:'7px',height:'7px',borderRadius:'4px',background:sd,animation:state.wsStatus==='connected'?'pulse 2s infinite':'none'}}));
hd.appendChild(h('span',{style:{fontSize:'14px',fontWeight:'700',color:'#C9A227'}},'Marcus'));
hd.appendChild(h('span',{style:{fontSize:'10px',color:'var(--text3)',fontWeight:'500'}},'AI Chief of Staff'));
hd.appendChild(h('div',{style:{flex:'1'}}));
hd.appendChild(h('button',{onClick:()=>{state.showChat=false;render()},style:{background:'none',border:'none',color:'var(--text3)',fontSize:'16px',fontWeight:'700'}},'‚úï'));p.appendChild(hd);
const ma=h('div',{style:{flex:'1',overflowY:'auto',padding:'12px',display:'flex',flexDirection:'column',gap:'8px'}});
ma.appendChild(h('div',{style:{background:'#16162A',borderRadius:'10px 10px 10px 4px',padding:'10px 14px',fontSize:'13px',color:'var(--text2)',lineHeight:'1.6',maxWidth:'88%'}},getGreeting()+", "+CONFIG.user.name+". What do you need?"));
state.chatMsgs.forEach(m=>{ma.appendChild(h('div',{style:{background:m.r==='u'?'#C9A22715':'#16162A',borderRadius:m.r==='u'?'10px 10px 4px 10px':'10px 10px 10px 4px',padding:'10px 14px',fontSize:'13px',color:m.r==='u'?'var(--text)':'var(--text2)',lineHeight:'1.6',maxWidth:'88%',alignSelf:m.r==='u'?'flex-end':'flex-start',whiteSpace:'pre-wrap',wordBreak:'break-word'}},m.t))});p.appendChild(ma);
const ir=h('div',{style:{padding:'10px 12px',borderTop:'1px solid var(--border)',display:'flex',gap:'6px',background:'#10101A',borderRadius:'0 0 14px 14px'}});
const ci=h('input',{placeholder:'Ask Marcus...',value:state.chatInput,style:{flex:'1',background:'#0A0A14',border:'1px solid var(--border)',borderRadius:'8px',padding:'8px 12px',color:'var(--text)',fontSize:'12px'}});
ci.oninput=e=>{state.chatInput=e.target.value};ci.onkeydown=e=>{if(e.key==='Enter')sendMsg(state.chatInput)};ir.appendChild(ci);
ir.appendChild(h('button',{onClick:()=>sendMsg(state.chatInput),style:{background:'#C9A227',border:'none',borderRadius:'8px',padding:'8px 14px',color:'#07070C',fontWeight:'700',fontSize:'13px'}},'‚Üí'));p.appendChild(ir);
setTimeout(()=>{ma.scrollTop=ma.scrollHeight},10);return p}

// ‚ïê‚ïê‚ïê MAIN ‚ïê‚ïê‚ïê
function render(){const a=document.getElementById('app');a.innerHTML='';a.appendChild(renderHeader());
if(state.screen==='vision')a.appendChild(renderVision());else a.appendChild(renderCommand());
const ch=renderChat();if(ch)a.appendChild(ch)}
//setInterval(()=>{state.affIdx=(state.affIdx+1)%VISION.affirmations.length;const ae=document.querySelector('.aff-text');if(ae)ae.textContent='\u2726 '+VISION.affirmations[state.affIdx]+' \u2726';},4000);

// Boot
fetchLiveData();
connectMarcus();
render();
function updateWsStatus(){document.querySelectorAll('.ws-dot').forEach(d=>{const c=state.wsStatus==='connected'?'#10B981':state.wsStatus==='connecting'?'#F59E0B':'#EF4444';d.style.background=c});document.querySelectorAll('.ws-label').forEach(l=>{l.textContent=state.wsStatus==='connected'?'ONLINE':state.wsStatus==='connecting'?'‚Ä¶':'OFFLINE';l.style.color=state.wsStatus==='connected'?'#10B981':state.wsStatus==='connecting'?'#F59E0B':'#EF4444'});}
console.log('‚öî EpicLife OS v2 loaded. Marcus ‚Üí',CONFIG.ws.url);
</script>
</body>
</html>
